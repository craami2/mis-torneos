<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Ninja Hub | Historial</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #1a1a1a; color: white; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        h1 { color: #00f2ff; text-align: center; text-transform: uppercase; letter-spacing: 3px; }
        
        /* Bot√≥n Volver */
        .btn-volver { display: inline-block; margin-bottom: 20px; color: #00f2ff; text-decoration: none; font-weight: bold; border: 1px solid #00f2ff; padding: 10px 20px; border-radius: 8px; transition: 0.3s; }
        .btn-volver:hover { background: #00f2ff; color: black; }

        /* Tabla de Logs */
        .tabla-contenedor { background: #2a2a2a; border-radius: 15px; overflow: hidden; border: 1px solid #444; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #333; }
        th { background-color: #333; color: #00f2ff; font-size: 0.8rem; text-transform: uppercase; }
        
        .positivo { color: #00ff88; font-weight: bold; }
        .negativo { color: #ff4444; font-weight: bold; }
        .fecha { color: #888; font-size: 0.85rem; }
        .badge { background: #444; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="btn-volver">‚Üê VOLVER AL INICIO</a>
        <h1>üìú Historial de Movimientos</h1>
        
        <div class="tabla-contenedor">
            <table>
                <thead>
                    <tr>
                        <th>Fecha y Hora</th>
                        <th>Ninja</th>
                        <th>Acci√≥n</th>
                        <th>Puntos</th>
                        <th>Detalle</th>
                    </tr>
                </thead>
                <tbody id="cuerpo-logs">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        const _supabase = supabase.createClient('https://ekaiwrnvbpwaaoenwnnp.supabase.co', 'sb_publishable_YvgUfE8sAXfAUGvXMcNB4Q_aGC2GUMP');

        async function cargarLogs() {
            const lista = document.getElementById('cuerpo-logs');
            lista.innerHTML = "<tr><td colspan='5' style='text-align:center;'>Cargando historial...</td></tr>";

            // Pedimos los logs ordenados por fecha (el m√°s nuevo arriba)
            const { data, error } = await _supabase
                .from('logs')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) {
                lista.innerHTML = "<tr><td colspan='5'>Error al cargar logs.</td></tr>";
                return;
            }

            lista.innerHTML = data.map(log => {
                const fecha = new Date(log.created_at).toLocaleString();
                const esPositivo = log.puntos_cambiados >= 0;
                const clasePuntos = esPositivo ? 'positivo' : 'negativo';
                const signo = esPositivo ? '+' : '';

                return `
                    <tr>
                        <td class="fecha">${fecha}</td>
                        <td><strong>${log.ninja_nombre}</strong></td>
                        <td><span class="badge">${log.tipo_accion}</span></td>
                        <td class="${clasePuntos}">${signo}${log.puntos_cambiados}</td>
                        <td style="color:#bbb;">${log.detalle}</td>
                    </tr>
                `;
            }).join('');
        }

        window.onload = cargarLogs;
    </script>
</body>
</html>
