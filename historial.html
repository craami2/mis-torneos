<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>URM | Auditoría</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --bg-color: #050505;
            --accent-cyan: #00f2ff;
            --glass-border: rgba(255, 255, 255, 0.08);
        }

        body { 
            margin: 0; padding: 0; font-family: 'Inter', 'Segoe UI', sans-serif; color: white;
            background-color: var(--bg-color);
            background-image: 
                radial-gradient(at 0% 0%, rgba(0, 242, 255, 0.08) 0px, transparent 40%),
                radial-gradient(at 100% 0%, rgba(169, 112, 255, 0.08) 0px, transparent 40%),
                radial-gradient(circle at 2px 2px, rgba(255, 255, 255, 0.03) 1px, transparent 0);
            background-size: 100% 100%, 100% 100%, 30px 30px;
            min-height: 100vh;
        }

        /* --- NAV PREMIUM --- */
        .premium-nav {
            position: sticky; top: 0; z-index: 1000;
            background: rgba(5, 5, 5, 0.75);
            backdrop-filter: blur(12px) saturate(180%);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--glass-border);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px; height: 64px;
        }
        .nav-logo { display: flex; align-items: center; gap: 10px; text-decoration: none; color: white; }
        .nav-logo-box { width: 28px; height: 28px; background: var(--accent-cyan); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: 900; color: #000; font-size: 0.9rem; }
        .nav-center { display: flex; gap: 30px; }
        .nav-link { color: #888; text-decoration: none; font-size: 0.85rem; font-weight: 500; transition: 0.2s; letter-spacing: 0.3px; text-transform: uppercase; }
        .nav-link:hover, .nav-link.active { color: #fff; }
        .btn-join { background: #fff; color: #000; padding: 7px 14px; border-radius: 6px; font-size: 0.8rem; font-weight: 600; text-decoration: none; transition: 0.2s; }

        /* --- CONTENEDOR --- */
        .main-wrapper { display: flex; justify-content: center; padding: 40px 20px; }
        .container { width: 100%; max-width: 1000px; }
        
        h1 { color: #fff; text-align: center; text-transform: uppercase; letter-spacing: 4px; margin-bottom: 30px; font-size: 1.5rem; }

        /* BUSCADOR Y FILTROS ESTILO CONSOLA */
        .filters {
            display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;
        }
        .filters input, .filters select {
            background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border);
            color: white; padding: 12px; border-radius: 8px; outline: none; flex: 1; min-width: 150px;
            font-size: 0.85rem; transition: 0.2s;
        }
        .filters input:focus { border-color: var(--accent-cyan); background: rgba(255,255,255,0.05); }

        /* TABLA GLASSMORPHISM REFINADA */
        .glass-panel {
            background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border); border-radius: 16px; overflow: hidden;
        }

        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: #888; padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); text-transform: uppercase; font-size: 0.7rem; letter-spacing: 1px; }
        td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.03); font-size: 0.9rem; }
        
        .fecha { color: #555; font-size: 0.8rem; white-space: nowrap; font-family: monospace; }
        .positivo { color: #00ff88; font-weight: 700; }
        .negativo { color: #ff4444; font-weight: 700; }
        .badge { background: rgba(255,255,255,0.05); padding: 4px 8px; border-radius: 4px; font-size: 0.65rem; border: 1px solid rgba(255,255,255,0.1); color: #ccc; text-transform: uppercase; font-weight: 600; }
        
        tr:last-child td { border-bottom: none; }
        tr:hover { background: rgba(255, 255, 255, 0.02); }
    </style>
</head>
<body>

    <nav class="premium-nav">
        <a href="index.html" class="nav-logo">
           
        </a>
        <div class="nav-center">
            <a href="index.html" class="nav-link">Inicio</a>
            <a href="leaderboard.html" class="nav-link">Clasificación</a>
            <a href="torneos.html" class="nav-link">Historial de Torneos</a>
            <a href="canje.html" class="nav-link">Canje</a>
            <a href="historial.html" class="nav-link active">Auditoría</a>
        </div>
        <div><a href="https://discord.gg/8hFxCK4CEM" target="_blank" class="btn-join">Unirse</a></div>
    </nav>

    <div class="main-wrapper">
        <div class="container">
            <h1>Auditoría de Movimientos</h1>

            <div class="filters">
                <input type="text" id="filter-ninja" placeholder="Buscar por usuario..." onkeyup="filtrar()">
                <select id="filter-accion" onchange="filtrar()">
                    <option value="">Todas las acciones</option>
                    <option value="Torneo">Torneo</option>
                    <option value="Canje">Canje</option>
                    <option value="Modificación">Modificación</option>
                </select>
            </div>
            
            <div class="glass-panel">
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha y Hora</th>
                                <th>Usuario</th>
                                <th>Acción</th>
                                <th style="text-align:right">Cambio</th>
                                <th>Detalle</th>
                            </tr>
                        </thead>
                        <tbody id="cuerpo-logs"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const _supabase = supabase.createClient('https://ekaiwrnvbpwaaoenwnnp.supabase.co', 'sb_publishable_YvgUfE8sAXfAUGvXMcNB4Q_aGC2GUMP');
        let todosLosLogs = [];

        async function cargarLogs() {
            const { data, error } = await _supabase
                .from('logs')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) return;
            todosLosLogs = data;
            renderizar(todosLosLogs);
        }

        function renderizar(logs) {
            const lista = document.getElementById('cuerpo-logs');
            lista.innerHTML = logs.map(log => {
                const fecha = new Date(log.created_at).toLocaleString('es-ES');
                const esPositivo = log.puntos_cambiados >= 0;
                const clasePuntos = esPositivo ? 'positivo' : 'negativo';
                const signo = esPositivo ? '+' : '';
                
                const puntosFormateados = Number(log.puntos_cambiados).toLocaleString('es-ES');

                return `
                    <tr>
                        <td class="fecha">${fecha}</td>
                        <td><strong>${log.ninja_nombre}</strong></td>
                        <td><span class="badge">${log.tipo_accion}</span></td>
                        <td class="${clasePuntos}" style="text-align:right">${signo}${puntosFormateados}</td>
                        <td style="color:#666; font-size: 0.8rem;">${log.detalle}</td>
                    </tr>
                `;
            }).join('');
        }

        function filtrar() {
            const busqueda = document.getElementById('filter-ninja').value.toLowerCase();
            const accion = document.getElementById('filter-accion').value;

            const filtrados = todosLosLogs.filter(log => {
                const coincideNinja = log.ninja_nombre.toLowerCase().includes(busqueda);
                const coincideAccion = accion === "" || log.tipo_accion === accion;
                return coincideNinja && coincideAccion;
            });

            renderizar(filtrados);
        }

        window.onload = cargarLogs;
    </script>
</body>
</html>