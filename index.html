<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ninja Hub | Inicio</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
     body {
    margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; color: white;
    background: linear-gradient(135deg, #0f0f0f, #1a1a2e, #16213e, #0f0f0f);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    min-height: 100vh;
    display: flex; justify-content: center;
}
@keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}
.container { 
    width: 90%; max-width: 800px; 
    padding: 40px 15px; box-sizing: border-box; 
}
h1 { 
    color: #00f2ff; text-align: center; text-transform: uppercase; 
    letter-spacing: 5px; text-shadow: 0 0 20px rgba(0,242,255,0.4); 
}
/* EFECTO CRISTAL PARA TABLAS Y CONTENEDORES */
.glass-panel {
    background: rgba(255, 255, 255, 0.03);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
    overflow: hidden;
    padding: 10px;
}
table { width: 100%; border-collapse: collapse; }
th { background: rgba(0, 242, 255, 0.1); color: #00f2ff; padding: 15px; text-align: left; }
td { padding: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); }

/* Botones con estilo Tienda */
.btn-action {
    display: block; width: 100%; background: #00f2ff; color: black; text-align: center;
    padding: 15px; border-radius: 12px; text-decoration: none; font-weight: bold;
    margin-top: 20px; transition: 0.3s; text-transform: uppercase; border: none;
}
.btn-action:hover { background: #fff; box-shadow: 0 0 15px #00f2ff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>UNION REPUBLICANA MULTICULTURAL</h1>

        <div class="nav-links">
            <a href="leaderboard.html" class="nav-btn">üèÜ VER RANKING COMPLETO</a>
            <a href="canje.html" class="nav-btn">üí∞ TIENDA DE CANJE</a>
            <a href="historial.html" class="nav-btn">üìú Historial de Puntos</a>
        </div>
        
        <div class="top-three" id="podio"></div>

        <div class="card">
            <div class="header-calendario">
                <button class="btn-mes" onclick="cambiarMes(-1)">‚óÄ ANTERIOR</button>
                <h2 id="mes-titulo" style="margin:0; color:#00f2ff;"></h2>
                <button class="btn-mes" onclick="cambiarMes(1)">SIGUIENTE ‚ñ∂</button>
            </div>
            <p style="color: #888; text-align: center;">Toca un d√≠a para ver los ganadores de ese torneo.</p>
            <div class="grid-calendario" id="calendario"></div>
            
            <div id="detalle-ganadores">
                <h3 id="fecha-seleccionada" style="color:#00f2ff; margin-top:0;"></h3>
                <div id="lista-ganadores-dia"></div>
            </div>
        </div>
    </div>

    <script>
        const _supabase = supabase.createClient('https://ekaiwrnvbpwaaoenwnnp.supabase.co', 'sb_publishable_YvgUfE8sAXfAUGvXMcNB4Q_aGC2GUMP');

        // Variables globales para controlar el tiempo
        let fechaActual = new Date();
        let mesVisualizado = fechaActual.getMonth();
        let anioVisualizado = fechaActual.getFullYear();

        async function init() {
            // Cargar Podio (Solo se carga una vez al inicio)
            const { data: n } = await _supabase.from('ranking').select('*').order('puntos', { ascending: false }).limit(3);
            if(n && n.length >= 3) {
                document.getElementById('podio').innerHTML = `
                    <div class="spot spot-2">ü•à<strong>${n[1].nombre}</strong><span>${n[1].puntos} PTS</span></div>
                    <div class="spot spot-1">üëë<strong>${n[0].nombre}</strong><span>${n[0].puntos} PTS</span></div>
                    <div class="spot spot-3">ü•â<strong>${n[2].nombre}</strong><span>${n[2].puntos} PTS</span></div>`;
            }
            renderizarCalendario();
        }

        async function renderizarCalendario() {
            const { data: e } = await _supabase.from('eventos').select('*');
            
            const nombresMeses = ["ENERO", "FEBRERO", "MARZO", "ABRIL", "MAYO", "JUNIO", "JULIO", "AGOSTO", "SEPTIEMBRE", "OCTUBRE", "NOVIEMBRE", "DICIEMBRE"];
            document.getElementById('mes-titulo').innerText = `${nombresMeses[mesVisualizado]} ${anioVisualizado}`;

            const diasEnMes = new Date(anioVisualizado, mesVisualizado + 1, 0).getDate();
            let html = '';
            
            for(let i=1; i<=diasEnMes; i++) {
                const fechaStr = `${anioVisualizado}-${String(mesVisualizado+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
                const evs = e.filter(ev => ev.fecha === fechaStr);
                
                // Comprobar si es el d√≠a de hoy real
                const hoyReal = new Date();
                const esHoy = i === hoyReal.getDate() && mesVisualizado === hoyReal.getMonth() && anioVisualizado === hoyReal.getFullYear();

                html += `<div class="dia ${esHoy ? 'hoy' : ''}" onclick="verGanadores('${fechaStr}', ${evs.length > 0 ? evs[0].id : null})">
                            ${i}${evs.map(ev=>`<div class="evento-tag">${ev.nombre}</div>`).join('')}
                         </div>`;
            }
            document.getElementById('calendario').innerHTML = html;
        }

        function cambiarMes(delta) {
            mesVisualizado += delta;
            if (mesVisualizado > 11) {
                mesVisualizado = 0;
                anioVisualizado++;
            } else if (mesVisualizado < 0) {
                mesVisualizado = 11;
                anioVisualizado--;
            }
            renderizarCalendario();
        }

        async function verGanadores(fecha, eventoId) {
            const detalle = document.getElementById('detalle-ganadores');
            const lista = document.getElementById('lista-ganadores-dia');
            document.getElementById('fecha-seleccionada').innerText = "Resultados del " + fecha;
            detalle.style.display = 'block';
            lista.innerHTML = "Cargando...";

            if(!eventoId) {
                lista.innerHTML = "<p>No hubo torneos programados para este d√≠a.</p>";
                return;
            }

            const { data: ganadores } = await _supabase.from('ganadores').select('*').eq('evento_id', eventoId);
            
            if(ganadores && ganadores.length > 0) {
                lista.innerHTML = "<h4>Ganadores anteriores:</h4>" + ganadores.map(g => `
                    <div class="ganador-item">
                        <strong>üë§ ${g.nombre_jugador}</strong><br>
                        <small>üéÅ Premio: ${g.premio || 'No especificado'}</small>
                    </div>
                `).join('');
            } else {
                lista.innerHTML = "<h4>Ganadores anteriores:</h4><p>No hay ganadores registrados para este torneo a√∫n.</p>";
            }
        }

        window.onload = init;
    </script>
</body>
</html>


